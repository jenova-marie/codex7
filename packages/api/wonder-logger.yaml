# üåê Codex7 REST API - Wonder Logger Configuration

service:
  name: ${SERVICE_NAME:-codex7-api}
  version: ${SERVICE_VERSION:-0.1.0-alpha}
  environment: ${NODE_ENV:-development}

logger:
  enabled: true
  level: ${LOG_LEVEL:-info}

  # Redact sensitive fields from logs
  redact:
    - password
    - token
    - apiKey
    - 'user.email'
    - 'user.password'
    - 'req.headers.authorization'
    - 'req.headers.cookie'
    - 'req.body.password'
    - 'req.body.apiKey'

  # Log transports
  transports:
    # Console output (pretty in dev, JSON in prod)
    - type: console
      pretty: ${LOG_PRETTY:-false}
      level: ${LOG_LEVEL:-info}

    # File logging (optional, for local debugging)
    - type: file
      dir: ${LOG_DIR:-./logs}
      fileName: ${LOG_FILE_NAME:-api.log}
      level: ${LOG_LEVEL:-info}

    # OpenTelemetry (send to Loki)
    - type: otel
      endpoint: ${OTEL_LOGS_ENDPOINT:-http://localhost:4318/v1/logs}
      level: ${LOG_LEVEL:-info}

    # Memory transport (for runtime inspection and testing)
    - type: memory
      name: ${SERVICE_NAME:-codex7-api}
      maxSize: ${MEMORY_LOG_MAX_SIZE:-10000}
      level: debug

  # Enable trace context injection
  plugins:
    traceContext: true

otel:
  enabled: ${OTEL_ENABLED:-true}

  # Distributed tracing
  tracing:
    enabled: ${OTEL_TRACING_ENABLED:-true}
    exporter: ${OTEL_TRACE_EXPORTER:-otlp}
    endpoint: ${OTEL_TRACES_ENDPOINT:-http://localhost:4318/v1/traces}
    sampleRate: ${OTEL_TRACE_SAMPLE_RATE:-1.0}

  # Metrics collection
  metrics:
    enabled: ${OTEL_METRICS_ENABLED:-true}
    exportIntervalMillis: ${OTEL_METRICS_INTERVAL:-60000}

    exporters:
      # Prometheus scrape endpoint
      - type: prometheus
        port: ${PROMETHEUS_PORT:-9465}

      # OTLP push to Prometheus
      - type: otlp
        endpoint: ${OTEL_METRICS_ENDPOINT:-http://localhost:4318/v1/metrics}

  # Automatic instrumentation
  instrumentation:
    auto: true
    http: true
